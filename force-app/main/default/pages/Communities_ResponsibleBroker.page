<apex:page controller="Communities_ResponsibleBroker" docType="html-5.0" showHeader="false" applyHtmlTag="false" applyBodyTag="false" standardStylesheets="false" lightningstylesheets="true">
    <apex:composition template="Communities_Base">
        <apex:define name="content">
            <apex:form id="regID">
                
                <c:Bootstrap_Resources />
                <link href="{!URLFOR($Resource.Communities_OfficeRoster,'/OfficeRoster/font-awesome.min.css')}" rel="stylesheet" type="text/css" />
                <apex:stylesheet value="{!URLFOR($Resource.ResponsibleBroker, 'ResponsibleBroker.css')}"/>
                <apex:pageBlock title="" id="error_details" rendered="{!hasInitialError}">
                    <div id="messages">
                        <apex:pagemessages ></apex:pagemessages>
                    </div>                    
                </apex:pageBlock>
                
                <apex:outputPanel rendered="{!hasError}">
                    <style>
                    .alert-danger{
                    margin-top:30px;
                    }
                	</style>
                    <p class="alert alert-danger">
                        Only your Broker of Record can assign a Responsible Broker. If you are the Broker of Record and unable to access this component, please contact our support team at support@brightmls.com.
                    </p>
                </apex:outputPanel>
                <apex:outputPanel rendered="{!!hasError}">
                    <apex:pageBlock title="" id="details" rendered="{!!hasInitialError}">
                        
                        <script>
                        
                        var activeTable;
                        var dataSet = {!RelationshipStr};
                        $(document).ready(function() {                    
                            
                            activeTable = $('#Offices').DataTable( {
                                "dom": '<"top"fi>rt<"bottom"lp><"clear">',
                                "data": dataSet,
                                "columns": [
                                    {
                                        "className":      'details-control',
                                        "orderable":      true,
                                        "data":           "Name",
                                        "defaultContent": ''
                                    },
                                    { "data": "SubId" },
                                    { 
                                        "className":      'details-control',
                                        "orderable":      true,
                                        "data":           "index",
                                        "defaultContent": ''
                                    },
                                    { "data": "State" },
                                    { "data": "Decision" }
                                ]
                            } );
                            
                            // Add event listener for opening and closing details
                            $('#Offices tbody').on('click', 'td.details-control', function () {
                                
                                var tr = $(this).closest('tr');
                                var row = activeTable.row( tr );
                                
                                if ( row.child.isShown() ) {
                                    // This row is already open - close it
                                    row.child.hide();
                                    tr.removeClass('shown');
                                }
                                else {
                                    // Open this row
                                    var obj = row.data();
                                    if(obj.index>0){
                                        var finalHTML = '';
                                        var officeDetailsStart = '<div class="arrow-up"></div><div class="slide-down"><h3>Offices assigned to '+ obj.Name +':<div style="float:right"><div class="label label-primary modifySubscriber" onclick="modify(\''+ obj.subRecId +'\');">Modify</div></div></h3><table class="table"><thead><tr><th>Name of Responsible Broker</th><th>Subscription ID</th><th>Offices Assigned</th><th>License State</th><th>License Type</th><th></thead><tbody>';
                                        for(var i in obj.lRelationship){
                                            var offiecrows = '<tr><td>'+obj.Name+'</td><td>'+obj.SubId+'</td><td>'+obj.lRelationship[i].Broker_Office__r.Name+'</td><td>'+obj.lRelationship[i].State__c+'</td><td>Broker</td>';
                                            finalHTML += offiecrows;
                                        }
                                        var officeDetailsEnd = '</tbody></table></div>';
                                        row.child( officeDetailsStart + finalHTML + officeDetailsEnd).show();                                        
                                        tr.addClass('shown');
                                        
                                        $('[data-toggle="tooltip"]').tooltip();
                                    }
                                }
                            } ); 
                            
                            $('#Offices_filter').addClass('col-sm-12');
                            $('#Offices_info').addClass('col-sm-12');
                            
                            $("#Offices_info").after( "<div style='clear:both;'></div>" );
                            $('#Offices_length').addClass('col-sm-6');
                            $('#Offices_paginate').addClass('col-sm-6');
                            $("#Offices_paginate").after( "<div style='clear:both;'></div>" );
                            $('[data-toggle="tooltip"]').tooltip();
                            
                            
                        });
                        
                        </script>                                                                         
                        
                        <div class="row content-block">
                            <div class="col-sm-12">
                                <c:Communities_Definition pageTitle="Assign Responsible Broker" pageTitleClass="fa fa-user fa-2x" hasDefinitions="false">
                                    <p><b class="term">Term</b> Definition goes here.</p>
                                </c:Communities_Definition>                 
                            </div>
                            
                            <div class="col-xs-12 instructions" style="padding-top:20px; padding-bottom:20px;">
                                <div class="col-xs-10">
                                    <p>Assign or remove a Responsible Broker on listings in your office(s) by state. The Responsible broker is the licensee recognized by the state licensing authority as the managing or responsible broker.  Associate Broker licensees may not be entered into this field.  To remove an individual as a Responsible Broker, go to their name below and click the number underneath the offices they are assigned followed by the Modify button.</p>
                                </div>
                                <div class="col-xs-2">
                                    <apex:commandButton style="margin-top:-150px;" action="{!addNewResponsibleBroker}" rerender="modalWindow" styleClass="btn btn-primary" value="Add New Responsible Broker"/>
                                </div>                            
                            </div>                          
                        </div>                                                            
                        <br/>
                        
                        <apex:actionFunction name="modify" action="{!modifyResponsibleBroker}" reRender="modalWindow">
                            <apex:param name="Parameter" assignTo="{!subscriberSelected}" value="" />
                        </apex:actionFunction>
                        
                        <apex:actionFunction name="SelectIndividual2" action="{!dummy}" reRender="Steps">
                            <apex:param name="Parameter" assignTo="{!subscriberSelected}" value="" />
                        </apex:actionFunction>
                        
                        <apex:actionFunction name="termsCheck" action="{!termsCheck}" reRender="Steps">
                        </apex:actionFunction>
                        
                        <apex:outputPanel id="contentPanel">
                            <div id="messages">
                                <apex:pagemessages ></apex:pagemessages>
                            </div>
                            <apex:outputPanel id="OfficeResults"> 
                                <div class="row content-block listing-block">
                                    <div class="col-sm-12">                                        
                                        <table class="table table-striped table-bordered" id="Offices">
                                            <thead>
                                                <tr>
                                                    <th>Name of Responsible Broker</th>
                                                    <th>Subscription ID</th>
                                                    <th>Offices Assigned</th>
                                                    <th>State</th>
                                                    <th>Decision</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                            </apex:outputPanel>
                            <!-- Add new authorized signer modal -->
                            <style>
                                .btn-primary{
                                min-width:100px;
                                }  
                                .alert{
                                margin-bottom:0;
                                } 
                                .modal-body{
                                padding:30px 20px 10px 20px;
                                } 
                                
                            </style>
                            <apex:outputPanel id="modalWindow">
                                <apex:outputPanel id="AddNewSignerModal" rendered="{!isAddNewResponsibleBroker}">
                                    <div class="modal fade" id="AddNewSigner-modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="false">
                                        <div class="modal-dialog modal-lg">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <apex:commandLink action="{!closeModal}" rerender="regID">
                                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                    </apex:commandLink>
                                                    <apex:outputPanel rendered="{!!isEdit}">
                                                        <h4 class="modal-title" id="modal-label"><i class="fa fa-user"></i> Add Responsible Broker</h4>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!isEdit}">
                                                        <h4 class="modal-title" id="modal-label"><i class="fa fa-user"></i> Modify Responsible Broker</h4>
                                                    </apex:outputPanel>
                                                </div>
                                                <apex:outputPanel id="Steps">
                                                    <div class="modal-body body_content">                        
                                                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                                                            
                                                            <!-- License information -->
                                                            <div class="panel panel-default {!if(searchBlockState == 'Started', 'active', 'inactive')}">
                                                                <div class="panel-heading" role="tab" id="headingOne">
                                                                    <div class="col-sm-12 menu-header menu-header-right" style="border-top:none;">
                                                                        <table style="width:100%;" class="panel-title">
                                                                            <tr>
                                                                                <td style="width:50px; vertical-align:top; text-align:center;">
                                                                                    1.
                                                                                </td>
                                                                                <td style="{!if(searchBlockState == 'Started', 'border-bottom:1px solid #95D1E6; padding-bottom:7px;', '')}">
                                                                                    <apex:outputPanel rendered="{!!isEdit}">
                                                                                        <apex:commandLink action="{!accordian1}" rerender="Steps">
                                                                                            Select Individual
                                                                                        </apex:commandLink>
                                                                                    </apex:outputPanel>
                                                                                    <apex:outputPanel rendered="{!isEdit}">
                                                                                        Select Individual
                                                                                    </apex:outputPanel>
                                                                                    
                                                                                    <p>Below are the subscribers under your authority who hold a Broker license with your firm by state. Please select the individual you wish to assign as a Responsible Broker for the offices and listings in your brokerage. You can only select one Responsible Broker per state.</p>
                                                                                </td>
                                                                                <td style="width:3%; color:#5cb85c;">
                                                                                    <apex:outputText rendered="{!if(searchBlockState == 'Completed', true, false)}">
                                                                                        <i class="glyphicon glyphicon-ok" />
                                                                                    </apex:outputText>
                                                                                </td>
                                                                            </tr>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div id="collapseOne" class="panel-collapse  {!if(searchBlockState == 'Started', 'collapse in', 'collapse')}" role="tabpanel" aria-labelledby="headingOne">
                                                                    <div class="panel-body">
                                                                        <table style="width:100%;">
                                                                            <tr>
                                                                                
                                                                                <td>                    
                                                                                    <div class="col-sm-12" style="border-bottom:1px solid #fff;">
                                                                                        <div class="col-sm-12">
                                                                                            
                                                                                            <div class="form-group form-table">
                                                                                                <table>
                                                                                                    <tr>
                                                                                                        <th></th>
                                                                                                        <th>Subscriber Name</th>
                                                                                                        <th>Subscription ID</th>
                                                                                                        <th>License Number</th>
                                                                                                        <th>License State</th>
                                                                                                        <th>License Expiration Date</th> 
                                                                                                        <th>License Type</th> 
                                                                                                    </tr>
                                                                                                    <apex:repeat value="{!subLic}" var="subLicense">
                                                                                                        <tr>
                                                                                                            <td>
                                                                                                                <apex:outputPanel rendered="{!subscriberSelected == subLicense.Id}">
                                                                                                                    <input type="radio" name="{!subscriptionId}" value="{!subLicense.Id}" onchange="SelectIndividual2(this.value);" checked='checked'/>
                                                                                                                </apex:outputPanel>
                                                                                                                <apex:outputPanel rendered="{!subscriberSelected != subLicense.Id}">
                                                                                                                    <input type="radio" name="{!subscriptionId}" value="{!subLicense.id}" onchange="SelectIndividual2(this.value);"/>
                                                                                                                </apex:outputPanel>
                                                                                                                
                                                                                                            </td>
                                                                                                            <td>{!subLicense.License_Contact_Name__c}</td>
                                                                                                            <td>{!subLicense.Subscription__r.name}</td>
                                                                                                            <td>{!subLicense.License__r.name}</td>
                                                                                                            <td>{!subLicense.License_State__c}</td>
                                                                                                            <td><apex:outputField value="{!subLicense.License__r.License_Expiration_Date__c}"/></td>
                                                                                                            <td>{!subLicense.License_Type__c}</td>
                                                                                                        </tr>
                                                                                                    </apex:repeat>
                                                                                                </table>
                                                                                            </div>
                                                                                        </div>                                                                                      
                                                                                    </div>
                                                                                    
                                                                                    
                                                                                    <div class="col-sm-12" style="padding:12px;">
                                                                                        <div class="col-sm-12">
                                                                                            <apex:commandButton id="Search" value="Continue" styleClass="btn btn-primary section1Button" action="{!individualSelected}" style="float:right;" reRender="Steps" disabled="{!disabled}"/>                                                                                                              
                                                                                        </div>
                                                                                    </div>
                                                                                    <div style="clear:both;" />
                                                                                    
                                                                                    
                                                                                </td>
                                                                                <td style="width:3%;"></td>
                                                                            </tr>
                                                                        </table>                        
                                                                    </div>
                                                                </div>                                                    
                                                                
                                                            </div>
                                                            
                                                            <!-- License information -->
                                                            <div class="panel panel-default {!if(assignBlockState == 'Started', 'active', 'inactive')}">
                                                                <div class="panel-heading" role="tab" id="headingOne">
                                                                    <div class="col-sm-12 menu-header menu-header-right">
                                                                        
                                                                        <table style="width:100%;" class="panel-title">
                                                                            <tr>
                                                                                <td style="width:50px; vertical-align:top; text-align:center;">
                                                                                    2.
                                                                                </td>
                                                                                <td style="{!if(assignBlockState == 'Started', 'border-bottom:1px solid #95D1E6; padding-bottom:7px;', '')}">
                                                                                    <apex:outputPanel rendered="{!!isEdit}">
                                                                                        <apex:commandLink action="{!accordian2}" reRender="Steps">
                                                                                            Assign Responsible Broker 
                                                                                        </apex:commandLink>
                                                                                        <p>The offices below have been assigned to this Responsible Broker by default.</p>
                                                                                    </apex:outputPanel>
                                                                                    <apex:outputPanel rendered="{!isEdit}">
                                                                                        <apex:commandLink action="{!accordian2}" reRender="Steps">
                                                                                            Remove Assigned Responsible Broker 
                                                                                        </apex:commandLink>
                                                                                        <p>To remove an assigned Responsible Broker, click the box below.</p>
                                                                                    </apex:outputPanel>
                                                                                </td>
                                                                                <td style="width:3%; color:#5cb85c;">
                                                                                    <apex:outputText rendered="{!if(assignBlockState == 'Completed', true, false)}">
                                                                                        <i class="glyphicon glyphicon-ok" />
                                                                                    </apex:outputText>
                                                                                </td>
                                                                            </tr>
                                                                        </table>
                                                                        
                                                                    </div>
                                                                </div>
                                                                
                                                                <div id="collapseTwo" class="panel-collapse  {!if(assignBlockState == 'Started', 'collapse in', 'collapse')}" role="tabpanel" aria-labelledby="headingOne">
                                                                    <div class="panel-body">
                                                                        <table style="width:100%;">
                                                                            <tr>
                                                                                <td style="width:50px; vertical-align:top; text-align:center;">
                                                                                    
                                                                                </td>
                                                                                <td>                    
                                                                                    <div class="col-md-12" style="padding:0; border-bottom:1px solid #fff;">
                                                                                        <div class="col-md-6">
                                                                                            <div class="email-broker">
                                                                                                <h2>{!subscriber.License_Contact_Name__c}</h2>
                                                                                                <h3>Phone: {!subscriber.Subscription__r.Primary_Phone__c}</h3>  
                                                                                                <h3>Email: {!subscriber.Subscription__r.Private_Email__c}</h3>
                                                                                                
                                                                                            </div>
                                                                                            
                                                                                        </div>
                                                                                        <div class="col-md-6">
                                                                                            <div class="email-broker">
                                                                                                <h2>{!subscriber.Subscription__r.Related_Location_Broker_Office__r.Account_Name__c} ({!subscriber.Subscription__r.Related_Location_Broker_Office__r.Name})</h2>
                                                                                                <h3>{!subscriber.Subscription__r.Related_Location_Broker_Office__r.Street_Number__c} {!subscriber.Subscription__r.Related_Location_Broker_Office__r.Street_Name__c} </h3>
                                                                                                <h3>{!subscriber.Subscription__r.Related_Location_Broker_Office__r.City__c} {!subscriber.Subscription__r.Related_Location_Broker_Office__r.State__c} {!subscriber.Subscription__r.Related_Location_Broker_Office__r.Zip__c}</h3>
                                                                                                
                                                                                            </div>
                                                                                        </div>
                                                                                        <div style="clear:both;" />
                                                                                        
                                                                                        <div class="col-md-12">
                                                                                            <div class="email-broker" >
                                                                                                <p>
                                                                                                    <span>License Number: {!subscriber.License__r.name}</span> <span>State: {!subscriber.License_State__c}</span> Expiration Date:&nbsp;<apex:outputField value="{!subscriber.License__r.License_Expiration_Date__c}"/> Type: {!subscriber.License_Type__c}
                                                                                                </p> 
                                                                                            </div></div>
                                                                                    </div>
                                                                                    <apex:outputPanel layout="none" rendered = "{!lOffice.size>0}">
                                                                                        <div style="clear:both;" />
                                                                                        <div class="col-md-12">
                                                                                            <div class="email-result">
                                                                                                <apex:repeat value="{!lOffice}" var="office">
                                                                                                    <h4>
                                                                                                        <apex:inputCheckbox styleClass="section2" value="{!office.check}" disabled="true"/> {!office.oAccount.name}({!office.oAccount.City__c}, {!office.oAccount.State__c})
                                                                                                    </h4>
                                                                                                </apex:repeat>
                                                                                            </div>
                                                                                        </div>                                                     
                                                                                        <apex:outputPanel rendered="{!isEdit}">
                                                                                            <div class="col-sm-12">
                                                                                                <div class="term-box" style="padding-top:10px; text-align:middle;">
                                                                                                    <apex:inputCheckbox value="{!assignOfficeDisable}" onclick="termsCheck()" />Remove Responsible Broker assignment from this individual. &nbsp; &nbsp;
                                                                                                </div>
                                                                                            </div> 
                                                                                        </apex:outputPanel>
                                                                                        
                                                                                        <div style="clear:both;" />
                                                                                        <div class="col-sm-12">
                                                                                            <div class="col-sm-12" style="padding-top:10px;">
                                                                                                <apex:commandButton value="Continue" styleClass="btn btn-primary section2Button" action="{!assignAuthority}" style="float:right;" reRender="Steps" disabled="{!(isEdit && !assignOfficeDisable)}"/>
                                                                                            </div>
                                                                                        </div>   
                                                                                    </apex:outputPanel>
                                                                                    <apex:outputPanel layout="none" rendered="{!(!isEdit && lOffice.size==0)}">                                                                                      
                                                                                        <table width="100%">
                                                                                            <tr>
                                                                                                <td>
                                                                                                    <div class="alert alert-danger" role="alert">
                                                                                                        No offices found to assign Responsible Broker 
                                                                                                    </div>
                                                                                                </td>
                                                                                            </tr>
                                                                                        </table>
                                                                                    </apex:outputPanel>
                                                                                    <apex:outputPanel layout="none" rendered="{!(isEdit && lOffice.size==0)}">                                                                                      
                                                                                        <table width="100%">
                                                                                            <tr>
                                                                                                <td>
                                                                                                    <div class="alert alert-danger" role="alert">
                                                                                                        No offices found. 
                                                                                                    </div>
                                                                                                </td>
                                                                                            </tr>
                                                                                        </table>
                                                                                    </apex:outputPanel>
                                                                                </td>
                                                                                <td style="width:3%;"></td>
                                                                            </tr>
                                                                        </table>                        
                                                                    </div>
                                                                </div>                                                    
                                                            </div>
                                                            
                                                            <!-- License information -->
                                                            <div class="panel panel-default {!if(reviewBlockState == 'Started', 'active', 'inactive')}">
                                                                <div class="panel-heading" role="tab" id="headingOne">
                                                                    <div class="col-sm-12 menu-header menu-header-right">
                                                                        <table style="width:100%;" class="panel-title">
                                                                            <tr>
                                                                                <td style="width:50px; vertical-align:top; text-align:center;">
                                                                                    3.
                                                                                </td>
                                                                                <td style="{!if(reviewBlockState == 'Started', 'border-bottom:1px solid #95D1E6; padding-bottom:7px;', '')}">
                                                                                    <apex:commandLink action="{!accordian3}" rerender="Steps">
                                                                                        Review Changes
                                                                                    </apex:commandLink>
                                                                                    <p>Please verify your changes before proceeding.</p>
                                                                                </td>
                                                                                <td style="width:3%; color:#5cb85c;">
                                                                                    <apex:outputText rendered="{!if(reviewBlockState == 'Completed', true, false)}">
                                                                                        <i class="glyphicon glyphicon-ok" />
                                                                                    </apex:outputText>      
                                                                                </td>
                                                                            </tr>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div id="collapseThree" class="panel-collapse  {!if(reviewBlockState == 'Started', 'collapse in', 'collapse')}" role="tabpanel" aria-labelledby="headingOne">
                                                                    <div class="panel-body">
                                                                        <table style="width:100%;">
                                                                            <tr>
                                                                                <td style="width:50px; vertical-align:top; text-align:center;">
                                                                                    
                                                                                </td>
                                                                                <td>                    
                                                                                    <div class="col-md-12" style="padding:0; border-bottom:1px solid #fff;">
                                                                                        <div class="col-md-6">
                                                                                            <div class="email-broker">
                                                                                                <h2>{!subscriber.License_Contact_Name__c}</h2>
                                                                                                <h3>Phone: {!subscriber.Subscription__r.Primary_Phone__c}</h3>  
                                                                                                <h3>Email: {!subscriber.Subscription__r.Private_Email__c}</h3>
                                                                                                
                                                                                            </div>
                                                                                            
                                                                                        </div>
                                                                                        <div class="col-md-6">
                                                                                            <div class="email-broker">
                                                                                                <h2>{!subscriber.Subscription__r.Related_Location_Broker_Office__r.Account_Name__c} ({!subscriber.Subscription__r.Related_Location_Broker_Office__r.Name})</h2>
                                                                                                <h3>{!subscriber.Subscription__r.Related_Location_Broker_Office__r.Street_Number__c} {!subscriber.Subscription__r.Related_Location_Broker_Office__r.Street_Name__c} </h3>
                                                                                                <h3>{!subscriber.Subscription__r.Related_Location_Broker_Office__r.City__c} {!subscriber.Subscription__r.Related_Location_Broker_Office__r.State__c} {!subscriber.Subscription__r.Related_Location_Broker_Office__r.Zip__c}</h3>
                                                                                                
                                                                                            </div>
                                                                                        </div>
                                                                                        <div style="clear:both;" />
                                                                                        <div class="col-md-12">
                                                                                            <div class="email-broker">
                                                                                                <p>
                                                                                                    <span> License Number: {!subscriber.License__r.name}</span> <span>State: {!subscriber.License_State__c}</span> Expiration Date:&nbsp;<apex:outputField value="{!subscriber.License__r.License_Expiration_Date__c}"/> Type: {!subscriber.License_Type__c}
                                                                                                </p> 
                                                                                            </div></div>
                                                                                    </div>
                                                                                    <div style="clear:both;" />
                                                                                    <div class="col-md-12" style="padding-top:10px; padding-bottom:15px; border-bottom:1px solid #fff;">
                                                                                        <div class="col-md-3">
                                                                                            <h5 style="padding-bottom:10px; border-bottom:1px solid white;"><b>Previous</b></h5>
                                                                                            <apex:repeat value="{!lOffice}" var="officeRecord" rendered="{!isEdit}">
                                                                                                <div style="New">{!officeRecord.oAccount.Name}</div>    
                                                                                            </apex:repeat>
                                                                                        </div>
                                                                                        <div class="col-md-3">
                                                                                            <h5 style="padding-bottom:10px; border-bottom:1px solid white;"><b>Added</b></h5>
                                                                                            <apex:repeat value="{!lOffice}" var="officeRecord" rendered="{!!isEdit}">
                                                                                                <div style="New">{!officeRecord.oAccount.Name}</div>    
                                                                                            </apex:repeat>                                           
                                                                                        </div>
                                                                                        <div class="col-md-3">
                                                                                            <h5 style="padding-bottom:10px; border-bottom:1px solid white;"><b>Removed</b></h5>
                                                                                            <apex:repeat value="{!lOffice}" var="officeRecord" rendered="{!isEdit}">
                                                                                                <div style="New">{!officeRecord.oAccount.Name}</div>    
                                                                                            </apex:repeat>
                                                                                        </div>
                                                                                        <div class="col-md-3">
                                                                                            <h5 style="padding-bottom:10px; border-bottom:1px solid white;"><b>Current</b></h5>
                                                                                            <apex:repeat value="{!lOffice}" var="officeRecord" rendered="{!!isEdit}">
                                                                                                <div style="New">{!officeRecord.oAccount.Name}</div>    
                                                                                            </apex:repeat>                                                                          
                                                                                        </div>                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                    </div>
                                                                                    
                                                                                    <div style="clear:both;" />                                                                            
                                                                                    
                                                                                    <div class="col-sm-12">
                                                                                        <div class="col-sm-12" style="padding-top:10px; text-align:right;">
                                                                                            <apex:commandButton value="Continue" styleClass="btn btn-primary" action="{!reviewChanges}" style="float:right;" reRender="Steps" />
                                                                                        </div>
                                                                                    </div>                                                                                                                                                       
                                                                                </td>
                                                                                <td style="width:3%;"></td>
                                                                            </tr>
                                                                        </table>                        
                                                                    </div>
                                                                </div>                                                         
                                                            </div>
                                                            
                                                            <!-- License information -->
                                                            <div class="panel panel-default {!if(termsBlockState == 'Started', 'active', 'inactive')}">
                                                                <div class="panel-heading" role="tab" id="headingOne">
                                                                    <div class="col-sm-12 menu-header menu-header-right">
                                                                        <table style="width:100%;" class="panel-title"> 
                                                                            <tr>
                                                                                <td style="width:50px; vertical-align:top; text-align:center;">
                                                                                    4.
                                                                                </td>
                                                                                <td style="{!if(termsBlockState == 'Started', 'border-bottom:1px solid #95D1E6; padding-bottom:7px;', '')}">
                                                                                    <apex:commandLink action="{!accordian4}" rerender="Steps">
                                                                                        Terms &amp; Conditions
                                                                                    </apex:commandLink>
                                                                                    <p>Additional terms for Designating a Responsible Broker.</p>
                                                                                </td>
                                                                                <td style="width:3%; color:#5cb85c;">
                                                                                    <apex:outputText rendered="{!if(termsBlockState == 'Completed', true, false)}">
                                                                                        <i class="glyphicon glyphicon-ok" />
                                                                                    </apex:outputText>      
                                                                                </td>
                                                                            </tr>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div id="collapseFour" class="panel-collapse  {!if(termsBlockState == 'Started', 'collapse in', 'collapse')}" role="tabpanel" aria-labelledby="headingOne">
                                                                    <div class="panel-body">
                                                                        <table style="width:100%;">
                                                                            <tr>
                                                                                <td style="width:50px; vertical-align:top; text-align:center;">
                                                                                    
                                                                                </td>
                                                                                <td>  
                                                                                    <apex:outputPanel rendered="{!!isEdit}">
                                                                                        <div class="col-md-12" style="padding-top:10px; padding-bottom:15px; border-bottom:1px solid #fff;">
                                                                                            <p>
                                                                                                I certify I am the Broker of Record and verify the Responsible Broker assignment that is being set for this individual. I understand that the individuals name and state license will now appear on listings as the Responsible Broker.
                                                                                            </p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                        </div>
                                                                                    </apex:outputPanel>
                                                                                    
                                                                                    <apex:outputPanel rendered="{!isEdit}">
                                                                                        <div class="col-md-12" style="padding-top:10px; padding-bottom:15px; border-bottom:1px solid #fff;">
                                                                                            <p>
                                                                                                I certify I am the Broker of Record and verify the Responsible Broker assignment that is being removed for this individual. I understand that the individuals name and state license will no longer appear as the Responsible Broker for this office(s) listings currently on-the-market.
                                                                                            </p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                        </div>
                                                                                    </apex:outputPanel>
                                                                                    <div style="clear:both;" />                                                                            
                                                                                    
                                                                                    <div class="col-sm-12">
                                                                                        <div class="col-sm-12" style="padding-top:10px; text-align:right;">
                                                                                            <apex:inputCheckbox value="{!termsDisabled}" onchange="termsCheck()"/>I accept the additional Terms for Designating a Responsible Broker &nbsp; &nbsp;
                                                                                            <apex:commandButton value="Continue" styleClass="btn btn-primary termButton" action="{!saveSigners}" reRender="Steps" disabled="{!!termsDisabled}" onclick="disableButton(this);"/>
                                                                                        </div>
                                                                                    </div>                                                                                                                                                       
                                                                                </td>
                                                                                <td style="width:3%;"></td>
                                                                            </tr>
                                                                        </table>                        
                                                                    </div>
                                                                </div>                                                         
                                                                
                                                            </div>
                                                            
                                                            <!-- License information -->
                                                            <div class="panel panel-default {!if(summaryBlockState == 'Started', 'active', 'inactive')}">
                                                                <div class="panel-heading" role="tab" id="headingOne">
                                                                    <div class="col-sm-12 menu-header menu-header-right">
                                                                        <table style="width:100%;" class="panel-title">
                                                                            <tr>
                                                                                <td style="width:50px; vertical-align:top; text-align:center;">
                                                                                    5.
                                                                                </td>
                                                                                <td style="{!if(summaryBlockState == 'Started', 'border-bottom:1px solid #95D1E6; padding-bottom:7px;', '')}">
                                                                                    <apex:commandLink action="{!accordian5}" rerender="Steps">
                                                                                        Summary
                                                                                    </apex:commandLink>
                                                                                    <p>Your changes to this individual have been made.</p>
                                                                                </td>
                                                                                <td style="width:3%; color:#5cb85c;">
                                                                                    <apex:outputText rendered="{!if(summaryBlockState == 'Completed', true, false)}">
                                                                                        <i class="glyphicon glyphicon-ok" />
                                                                                    </apex:outputText>      
                                                                                </td>
                                                                            </tr>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div id="collapseFive" class="panel-collapse  {!if(summaryBlockState == 'Started', 'collapse in', 'collapse')}" role="tabpanel" aria-labelledby="headingOne">
                                                                    <div class="panel-body">
                                                                        <table style="width:100%;">
                                                                            <tr>
                                                                                <td style="width:50px; vertical-align:top; text-align:center;">
                                                                                    
                                                                                </td>
                                                                                <td>                    
                                                                                    <div class="col-md-12" style="padding-top:10px; padding-bottom:15px;">
                                                                                        <apex:outputPanel rendered="{!errorMessage == ''}">
                                                                                            <div class="alert alert-success" role="alert">
                                                                                                <strong>
                                                                                                    <apex:outputPanel rendered="{!!isEdit}">
                                                                                                        Responsible Broker Assigned
                                                                                                    </apex:outputPanel>
                                                                                                    <apex:outputPanel rendered="{!isEdit}">
                                                                                                        Responsible Broker Removed
                                                                                                    </apex:outputPanel>
                                                                                                </strong><br/><br/> 
                                                                                                Thank you, the saved changes  are now effective.
                                                                                            </div>
                                                                                        </apex:outputPanel>
                                                                                        <apex:outputPanel rendered="{!errorMessage != ''}">
                                                                                            <div class="alert alert-danger" role="alert">
                                                                                                <strong>Responsible Broker Update Failed</strong><br/><br/>
                                                                                                {!errorMessage}
                                                                                            </div>
                                                                                        </apex:outputPanel>                                                                                   
                                                                                    </div>
                                                                                    <apex:commandButton value="Done" styleClass="btn btn-primary" action="{!closeModal}" reRender="regID"  style="float:right; margin-right: 40px !important" html-data-dismiss="modal"/>
                                                                                    
                                                                                    <div style="clear:both;" />                                                                                                                                                                                                                           
                                                                                </td>
                                                                                <td style="width:3%;"></td>
                                                                            </tr>
                                                                        </table>                        
                                                                    </div>
                                                                </div>                                                         
                                                                
                                                            </div>                                                                                                    
                                                            
                                                        </div>
                                                    </div> 
                                                </apex:outputPanel>                                       
                                            </div>
                                        </div>
                                    </div>
                                </apex:outputPanel>                  
                                
                                <apex:outputPanel id="AddNewSigner" rendered="{!isAddNewResponsibleBroker}">
                                    <script>
                                    $(document).ready(function(){
                                        $('#AddNewSigner-modal').modal('show');                         
                                    });
                                    
                                    function disableButton(btn){
                                        document.getElementById(btn.id).disabled = true;
                                    }
                                    </script>
                                </apex:outputPanel>                  	
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </apex:pageBlock>
                </apex:outputPanel> 
            </apex:form>                
        </apex:define>                
    </apex:composition> 
    
    <script src="{!URLFOR($Resource.Communities_OfficeRoster,'/OfficeRoster/jquery.dataTables.min.js')}"></script>
    <script src="{!URLFOR($Resource.Communities_OfficeRoster,'/OfficeRoster/dataTables.bootstrap.min.js')}"></script>
    <link href="{!URLFOR($Resource.Communities_OfficeRoster,'/OfficeRoster/dataTables.bootstrap.min.css')}" rel="stylesheet" type="text/css" />
    <link href = "https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel = "stylesheet" />
    <script src = "https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>      
    </apex:page>