<?xml version="1.0" encoding="UTF-8"?>
<Workflow xmlns="http://soap.sforce.com/2006/04/metadata">
    <alerts>
        <fullName>Add_Authorized_Signer_Notification</fullName>
        <description>Add Authorized Signer Notification</description>
        <protected>false</protected>
        <recipients>
            <field>Contact__c</field>
            <type>contactLookup</type>
        </recipients>
        <senderAddress>billing@mris.net</senderAddress>
        <senderType>OrgWideEmailAddress</senderType>
        <template>API_Names/BRIGHT_AuthorizedSigner_Offices</template>
    </alerts>
    <alerts>
        <fullName>Add_Authorized_Signer_Notification_Email_to_SF</fullName>
        <ccEmails>emailtosalesforce@5-2ijsaxt3w491q1lp6mgopwf1bwap8tktw7ffpwk8v71kew5gl1.z-n9io6maj.cs11.le.sandbox.salesforce.com</ccEmails>
        <description>Add Authorized Signer Notification Email to SF</description>
        <protected>false</protected>
        <senderAddress>billing@mris.net</senderAddress>
        <senderType>OrgWideEmailAddress</senderType>
        <template>API_Names/BRIGHT_AuthorizedSigner_Offices</template>
    </alerts>
    <alerts>
        <fullName>Add_Authorized_Signer_Notification_to_Broker</fullName>
        <description>Add Authorized Signer Notification to Broker</description>
        <protected>false</protected>
        <recipients>
            <type>owner</type>
        </recipients>
        <senderType>CurrentUser</senderType>
        <template>API_Names/BRIGHT_AuthorizedSigner_Offices_Broker</template>
    </alerts>
    <alerts>
        <fullName>Add_Authorized_Signer_Notification_to_Broker_Email_to_SF</fullName>
        <ccEmails>emailtosalesforce@5-2ijsaxt3w491q1lp6mgopwf1bwap8tktw7ffpwk8v71kew5gl1.z-n9io6maj.cs11.le.sandbox.salesforce.com</ccEmails>
        <description>Add Authorized Signer Notification to Broker Email to SF</description>
        <protected>false</protected>
        <senderAddress>billing@mris.net</senderAddress>
        <senderType>OrgWideEmailAddress</senderType>
        <template>API_Names/BRIGHT_AuthorizedSigner_Offices_Broker</template>
    </alerts>
    <alerts>
        <fullName>BRIGHT_Add_Authorized_Signer_Notification</fullName>
        <description>BRIGHT Add Authorized Signer Notification</description>
        <protected>false</protected>
        <recipients>
            <field>Contact__c</field>
            <type>contactLookup</type>
        </recipients>
        <senderType>DefaultWorkflowUser</senderType>
        <template>API_Names/Bright_MLS_AuthSigner_Added_to_AuthSigner</template>
    </alerts>
    <alerts>
        <fullName>BRIGHT_Add_Authorized_Signer_Notification_Email_to_SF</fullName>
        <ccEmails>emailtosalesforce@5-2ijsaxt3w491q1lp6mgopwf1bwap8tktw7ffpwk8v71kew5gl1.z-n9io6maj.cs11.le.sandbox.salesforce.com</ccEmails>
        <description>BRIGHT Add Authorized Signer Notification Email to SF</description>
        <protected>false</protected>
        <senderAddress>billing@mris.net</senderAddress>
        <senderType>OrgWideEmailAddress</senderType>
        <template>API_Names/Bright_MLS_AuthSigner_Added_to_AuthSigner</template>
    </alerts>
    <alerts>
        <fullName>BRIGHT_Add_Authorized_Signer_Notification_to_Broker</fullName>
        <description>BRIGHT Add Authorized Signer Notification to Broker</description>
        <protected>false</protected>
        <recipients>
            <type>owner</type>
        </recipients>
        <senderType>CurrentUser</senderType>
        <template>API_Names/Bright_MLS_New_AuthSigner_Added_to_Broker</template>
    </alerts>
    <alerts>
        <fullName>BRIGHT_Add_Authorized_Signer_Notification_to_Broker_Email_to_SF</fullName>
        <ccEmails>emailtosalesforce@5-2ijsaxt3w491q1lp6mgopwf1bwap8tktw7ffpwk8v71kew5gl1.z-n9io6maj.cs11.le.sandbox.salesforce.com</ccEmails>
        <description>BRIGHT Add Authorized Signer Notification to Broker Email to SF</description>
        <protected>false</protected>
        <senderAddress>billing@mris.net</senderAddress>
        <senderType>OrgWideEmailAddress</senderType>
        <template>API_Names/Bright_MLS_New_AuthSigner_Added_to_Broker</template>
    </alerts>
    <alerts>
        <fullName>BRIGHT_MLS_Broker_Authorized_Signer_Designation_Changed</fullName>
        <description>BRIGHT MLS Broker Authorized Signer Designation Changed</description>
        <protected>false</protected>
        <recipients>
            <type>owner</type>
        </recipients>
        <senderType>CurrentUser</senderType>
        <template>API_Names/BRIGHT_MLS_Broker_Authorized_Signer_Designation_Changed</template>
    </alerts>
    <alerts>
        <fullName>BRIGHT_MLS_Broker_Authorized_Signer_Designation_Changed_Email_to_SF</fullName>
        <ccEmails>emailtosalesforce@5-2ijsaxt3w491q1lp6mgopwf1bwap8tktw7ffpwk8v71kew5gl1.z-n9io6maj.cs11.le.sandbox.salesforce.com</ccEmails>
        <description>BRIGHT MLS Broker Authorized Signer Designation Changed Email to SF</description>
        <protected>false</protected>
        <senderType>CurrentUser</senderType>
        <template>API_Names/BRIGHT_MLS_Broker_Authorized_Signer_Designation_Changed</template>
    </alerts>
    <alerts>
        <fullName>New_Responsible_Broker_Email_to_Subscriber</fullName>
        <description>New Responsible Broker Email to Subscriber</description>
        <protected>false</protected>
        <recipients>
            <field>Subscription_Private_Email__c</field>
            <type>email</type>
        </recipients>
        <senderAddress>billing@mris.net</senderAddress>
        <senderType>OrgWideEmailAddress</senderType>
        <template>API_Names/New_Responsible_Broker_Assignment_Email_for_Subscriber</template>
    </alerts>
    <alerts>
        <fullName>New_Responsible_Broker_Email_to_Subscriber_to_SF</fullName>
        <ccEmails>emailtosalesforce@5-2ijsaxt3w491q1lp6mgopwf1bwap8tktw7ffpwk8v71kew5gl1.z-n9io6maj.cs11.le.sandbox.salesforce.com</ccEmails>
        <description>New Responsible Broker Email to Subscriber to SF</description>
        <protected>false</protected>
        <senderAddress>billing@mris.net</senderAddress>
        <senderType>OrgWideEmailAddress</senderType>
        <template>API_Names/New_Responsible_Broker_Assignment_Email_for_Subscriber</template>
    </alerts>
    <fieldUpdates>
        <fullName>Bright_updateSuperParentAccount</fullName>
        <field>Super_Parent_Account_Id__c</field>
        <formula>CASESAFEID( Broker_Office__r.Super_Parent_Account_Id__c)</formula>
        <name>Bright_updateSuperParentAccount</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>CreatedSource</fullName>
        <field>Created_Source__c</field>
        <name>CreatedSource</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Null</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <outboundMessages>
        <fullName>LMS_Relationship_Update</fullName>
        <apiVersion>29.0</apiVersion>
        <description>CSOD LMS</description>
        <endpointUrl>https://pervasive.mris.com:8443/DI_CSOD_LMS</endpointUrl>
        <fields>AgentKey__c</fields>
        <fields>Broker_Office_Code__c</fields>
        <fields>Id</fields>
        <fields>Relationship_Type__c</fields>
        <fields>Status__c</fields>
        <fields>Subscription_ID__c</fields>
        <includeSessionId>true</includeSessionId>
        <integrationUser>mrisadmin@mris.net</integrationUser>
        <name>LMS Relationship Update</name>
        <protected>false</protected>
        <useDeadLetterQueue>false</useDeadLetterQueue>
    </outboundMessages>
    <outboundMessages>
        <fullName>Relationship_Update</fullName>
        <apiVersion>45.0</apiVersion>
        <endpointUrl>http://talend.dev.brightmls.com/services/SFRelationship</endpointUrl>
        <fields>Id</fields>
        <fields>Service_Jurisdiction__c</fields>
        <includeSessionId>false</includeSessionId>
        <integrationUser>mris_sf_api@mris.net</integrationUser>
        <name>Relationship_Update</name>
        <protected>false</protected>
        <useDeadLetterQueue>false</useDeadLetterQueue>
    </outboundMessages>
    <outboundMessages>
        <fullName>SFDC_Relationship</fullName>
        <apiVersion>52.0</apiVersion>
        <endpointUrl>https://sfdcservices.dev.brightmls.com/relationship</endpointUrl>
        <fields>Id</fields>
        <fields>Service_Jurisdiction__c</fields>
        <fields>SystemModstamp</fields>
        <includeSessionId>true</includeSessionId>
        <integrationUser>mris_sf_api@mris.net</integrationUser>
        <name>SFDC Relationship</name>
        <protected>false</protected>
        <useDeadLetterQueue>false</useDeadLetterQueue>
    </outboundMessages>
    <rules>
        <fullName>Add Authorized Signer Notification</fullName>
        <actions>
            <name>Add_Authorized_Signer_Notification</name>
            <type>Alert</type>
        </actions>
        <actions>
            <name>Add_Authorized_Signer_Notification_Email_to_SF</name>
            <type>Alert</type>
        </actions>
        <actions>
            <name>Add_Authorized_Signer_Notification_to_Broker</name>
            <type>Alert</type>
        </actions>
        <actions>
            <name>Add_Authorized_Signer_Notification_to_Broker_Email_to_SF</name>
            <type>Alert</type>
        </actions>
        <active>true</active>
        <criteriaItems>
            <field>Relationship__c.Relationship_Type__c</field>
            <operation>equals</operation>
            <value>Authorized Signer</value>
        </criteriaItems>
        <criteriaItems>
            <field>Relationship__c.Status__c</field>
            <operation>equals</operation>
            <value>Active</value>
        </criteriaItems>
        <criteriaItems>
            <field>Relationship__c.Created_Source__c</field>
            <operation>equals</operation>
            <value>Connect</value>
        </criteriaItems>
        <criteriaItems>
            <field>Relationship__c.Service_Jurisdiction__c</field>
            <operation>notEqual</operation>
            <value>BRIGHT</value>
        </criteriaItems>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>BRIGHT - Add Authorized Signer Notification</fullName>
        <actions>
            <name>BRIGHT_Add_Authorized_Signer_Notification</name>
            <type>Alert</type>
        </actions>
        <actions>
            <name>BRIGHT_Add_Authorized_Signer_Notification_Email_to_SF</name>
            <type>Alert</type>
        </actions>
        <actions>
            <name>BRIGHT_Add_Authorized_Signer_Notification_to_Broker</name>
            <type>Alert</type>
        </actions>
        <actions>
            <name>BRIGHT_Add_Authorized_Signer_Notification_to_Broker_Email_to_SF</name>
            <type>Alert</type>
        </actions>
        <active>true</active>
        <criteriaItems>
            <field>Relationship__c.Relationship_Type__c</field>
            <operation>equals</operation>
            <value>Authorized Signer</value>
        </criteriaItems>
        <criteriaItems>
            <field>Relationship__c.Status__c</field>
            <operation>equals</operation>
            <value>Active</value>
        </criteriaItems>
        <criteriaItems>
            <field>Relationship__c.Created_Source__c</field>
            <operation>equals</operation>
            <value>Connect</value>
        </criteriaItems>
        <criteriaItems>
            <field>Relationship__c.Service_Jurisdiction__c</field>
            <operation>equals</operation>
            <value>BRIGHT</value>
        </criteriaItems>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>BRIGHT Relationship_Inactivated</fullName>
        <actions>
            <name>BRIGHT_MLS_Broker_Authorized_Signer_Designation_Changed</name>
            <type>Alert</type>
        </actions>
        <actions>
            <name>BRIGHT_MLS_Broker_Authorized_Signer_Designation_Changed_Email_to_SF</name>
            <type>Alert</type>
        </actions>
        <active>true</active>
        <formula>AND(  NOT(ISPICKVAL(PRIORVALUE(Status__c),&quot;In Progress&quot;)), ISPICKVAL(Status__c,  &quot;Inactive&quot;), Service_Jurisdiction__c= &quot;BRIGHT&quot;,(ISPICKVAL((Relationship_Type__c),&quot;Authorized Signer&quot;)) )</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Bright_updateSuperParentAccount</fullName>
        <actions>
            <name>Bright_updateSuperParentAccount</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <formula>OR( ISNEW() , ISCHANGED(  Broker_Office__c ))</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>LMS Capture relationship update</fullName>
        <actions>
            <name>LMS_Relationship_Update</name>
            <type>OutboundMessage</type>
        </actions>
        <active>false</active>
        <description>Sends an outbound message to update the LMS.</description>
        <formula>ISPICKVAL( Subscription__r.Status__c, &apos;Active&apos; ) &amp;&amp; (ISPICKVAL( Relationship_Type__c , &apos;Broker Of Record&apos;) ||  ISPICKVAL( Relationship_Type__c , &apos;Office Manager&apos;) || ISPICKVAL( Relationship_Type__c , &apos;Authorized Signer&apos;)) &amp;&amp; (ISCHANGED( Broker_Office__c ) || ISCHANGED(  Subscription__c ) || ISCHANGED( Broker_Office__c ) || ISCHANGED( Status__c ) || ISCHANGED( SysPrRoleKey__c ) || ISCHANGED( Resend_to_LMS_Flag__c ) )</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Relationship_Inactivated</fullName>
        <actions>
            <name>SFDC_Relationship</name>
            <type>OutboundMessage</type>
        </actions>
        <active>true</active>
        <criteriaItems>
            <field>Relationship__c.Status__c</field>
            <operation>equals</operation>
            <value>Inactive</value>
        </criteriaItems>
        <criteriaItems>
            <field>Relationship__c.RecordTypeId</field>
            <operation>equals</operation>
            <value>Individual to Office</value>
        </criteriaItems>
        <criteriaItems>
            <field>Relationship__c.Service_Jurisdiction__c</field>
            <operation>equals</operation>
            <value>BRIGHT</value>
        </criteriaItems>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>Relationship_Updated</fullName>
        <actions>
            <name>SFDC_Relationship</name>
            <type>OutboundMessage</type>
        </actions>
        <active>true</active>
        <criteriaItems>
            <field>Relationship__c.Status__c</field>
            <operation>equals</operation>
            <value>Active</value>
        </criteriaItems>
        <criteriaItems>
            <field>Relationship__c.RecordTypeId</field>
            <operation>equals</operation>
            <value>Individual to Office</value>
        </criteriaItems>
        <criteriaItems>
            <field>Relationship__c.Service_Jurisdiction__c</field>
            <operation>equals</operation>
            <value>BRIGHT</value>
        </criteriaItems>
        <description>Evaluate the rule when a record is created, and every time it&apos;s edited</description>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>Update Relationship in LMS</fullName>
        <actions>
            <name>LMS_Relationship_Update</name>
            <type>OutboundMessage</type>
        </actions>
        <active>false</active>
        <description>Sends an outbound message to update the LMS.</description>
        <formula>(ISPICKVAL( Relationship_Type__c , &apos;Broker Of Record&apos;) ||  ISPICKVAL( Relationship_Type__c , &apos;Office Manager&apos;) || ISPICKVAL( Relationship_Type__c , &apos;Authorized Signer&apos;)) &amp;&amp; (ISNEW() || ISCHANGED( Broker_Office__c ) || ISCHANGED(  Subscription__c ) || ISCHANGED( Broker_Office__c ) || ISCHANGED( Status__c ))</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
</Workflow>
